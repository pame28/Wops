<form
  id="crudForm"
  [formGroup]="puestoTrabajoForm"
  (ngSubmit)="savePuestoTrabajo()"
  class="form-vertical"
>
  <!-- Nombre del puesto -->
  <label>Nombre Puesto de Trabajo</label>
  <input type="text" formControlName="nombre" />
  <div class="error"
       *ngIf="puestoTrabajoForm.get('nombre')?.touched && puestoTrabajoForm.get('nombre')?.invalid">
    * Campo obligatorio
  </div>

  <!-- Área con búsqueda -->
  <mat-form-field appearance="outline" class="w-100">
    <mat-label>Área</mat-label>
    <input type="text" placeholder="Seleccione un área" matInput [formControl]="areaCtrl" [matAutocomplete]="auto">
    
    <mat-autocomplete #auto="matAutocomplete">
      <mat-option *ngFor="let area of filteredAreas | async" [value]="area.nombre">
        {{ area.nombre }}
      </mat-option>
    </mat-autocomplete>

    <mat-error *ngIf="puestoTrabajoForm.get('areaId')?.touched && puestoTrabajoForm.get('areaId')?.invalid">
      Campo obligatorio
    </mat-error>
  </mat-form-field>
</form>









import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatInputModule } from '@angular/material/input';
import { MatAutocompleteModule } from '@angular/material/autocomplete';
import { Observable, map, startWith } from 'rxjs';
import { PuestosTrabajoService } from './services/puestos-trabajo.service';
import { AreasService } from '../areas/services/areas.service';

interface Area {
  id: string | number;
  nombre: string;
}

@Component({
  selector: 'app-puestos-trabajo',
  standalone: true,
  imports: [
    CommonModule,
    ReactiveFormsModule,
    MatFormFieldModule,
    MatInputModule,
    MatAutocompleteModule,
  ],
  templateUrl: './puestos-trabajo.component.html',
  styleUrls: ['./puestos-trabajo.component.css'],
})
export class PuestosTrabajoComponent implements OnInit {
  puestoTrabajoForm!: FormGroup;
  areaCtrl = new FormBuilder().control('', Validators.required); // control de búsqueda
  areas: Area[] = [];
  filteredAreas!: Observable<Area[]>;

  constructor(private fb: FormBuilder, private puestosTrabajoService: PuestosTrabajoService, private areasService: AreasService) {}

  ngOnInit(): void {
    this.puestoTrabajoForm = this.fb.group({
      nombre: ['', Validators.required],
      areaId: ['', Validators.required],
    });

    this.loadAreas();
  }

  loadAreas() {
    this.areasService.getAreas().subscribe({
      next: (resp) => {
        this.areas = (resp as any).data ?? resp;

        // Filtrado de búsqueda
        this.filteredAreas = this.areaCtrl.valueChanges.pipe(
          startWith(''),
          map((value) => this._filterAreas(value))
        );
      },
      error: () => alert('Error al cargar áreas'),
    });
  }

  private _filterAreas(value: string): Area[] {
    const filterValue = value.toLowerCase();
    return this.areas.filter((area) => area.nombre.toLowerCase().includes(filterValue));
  }
}




:host ::ng-deep .mat-form-field-appearance-outline {
  width: 100%;
  border-radius: 8px;
  border: 1px solid var(--bp-blue-experto);
  box-shadow: none;
  margin-top: 8px;
}

/* Focus */
:host ::ng-deep .mat-form-field-appearance-outline.mat-focused {
  border-color: var(--bp-aqua-digital);
  box-shadow: 0 0 0 2px var(--bp-aqua-digital);
}

/* Hover */
:host ::ng-deep .mat-select:hover .mat-select-trigger {
  background-color: #f0f8ff;
}

/* Opciones */
:host ::ng-deep .mat-mdc-option:hover {
  background-color: #007bff;
  color: white;
}

/* Panel de opciones */
:host ::ng-deep .mat-mdc-autocomplete-panel {
  max-height: 250px;
  font-size: 14px;
}




